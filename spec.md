# wekey-skf äº§å“è§„æ ¼è¯´æ˜ä¹¦

> **ç‰ˆæœ¬**: 1.0.0-draft
> **æ—¥æœŸ**: 2026-02-06
> **çŠ¶æ€**: å¾…è¯„å®¡

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

`wekey-skf` æ˜¯ TrustAsia å¯†ç è®¾å¤‡ç®¡ç†å·¥å…·çš„ C++/Qt é‡æ„ç‰ˆæœ¬ï¼ŒåŸé¡¹ç›® `ts-wekey-skf` åŸºäº Go + CGO + React å®ç°ã€‚

### 1.2 é‡æ„åŠ¨æœº

åŸé¡¹ç›®ä½¿ç”¨ CGO è°ƒç”¨ C è¯­è¨€ SKF åº“ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- å†…å­˜ç®¡ç†ä¸å¯æ§ï¼Œå¯¼è‡´å¶å‘æ€§å´©æºƒ
- å¥æŸ„ç”Ÿå‘½å‘¨æœŸéš¾ä»¥ç²¾ç¡®ç®¡ç†
- è·¨å¹³å°ç¼–è¯‘é“¾å¤æ‚

C++ å¯ç›´æ¥è°ƒç”¨ C APIï¼Œå½»åº•è§£å†³ä¸Šè¿°é—®é¢˜ã€‚

### 1.3 é¡¹ç›®ç›®æ ‡

1. **åŠŸèƒ½å®Œæ•´ç§»æ¤** â€” å®ç°åŸé¡¹ç›®å…¨éƒ¨åŠŸèƒ½
2. **API å®Œå…¨å…¼å®¹** â€” HTTP API ä¿æŒå‘åå…¼å®¹
3. **ç¨³å®šæ€§æå‡** â€” æ¶ˆé™¤å†…å­˜ç®¡ç†ç›¸å…³çš„å¶å‘æ•…éšœ
4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** â€” åŸç”Ÿ Qt æ¡Œé¢ç•Œé¢

### 1.4 ç›®æ ‡ç”¨æˆ·

| ç”¨æˆ·ç±»å‹ | ä½¿ç”¨åœºæ™¯ |
|----------|----------|
| å†…éƒ¨è¿ç»´ | æ‰¹é‡ç®¡ç†ä¼ä¸šå¯†ç è®¾å¤‡ |
| å¼€å‘æµ‹è¯• | è°ƒè¯• SKF é›†æˆåŠŸèƒ½ |
| æœ€ç»ˆå®¢æˆ· | ç®¡ç†ä¸ªäºº/ä¼ä¸šè¯ä¹¦ |

### 1.5 å¹³å°æ”¯æŒ

| å¹³å° | ä¼˜å…ˆçº§ | æœ€ä½ç‰ˆæœ¬ |
|------|--------|----------|
| Windows | P0 | Windows 10 |
| macOS | P1 | macOS 11 (Big Sur) |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„æ¨¡å¼

é‡‡ç”¨ **æ··åˆæ¨¡å¼**ï¼šQt æ¡Œé¢ GUI + HTTP API Server å¹¶è¡Œè¿è¡Œã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    wekey-skf åº”ç”¨                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Qt GUI        â”‚    â”‚   HTTP API Server (:9001)   â”‚ â”‚
â”‚  â”‚  (Qt Widgets)   â”‚    â”‚   (å…¼å®¹åŸ API)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                           â”‚                 â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                       â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Core Service Layer                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ Device  â”‚ â”‚   App   â”‚ â”‚Containerâ”‚ â”‚  Crypto   â”‚ â”‚â”‚
â”‚  â”‚  â”‚ Manager â”‚ â”‚ Manager â”‚ â”‚ Manager â”‚ â”‚  Service  â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Driver Plugin System                   â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚â”‚
â”‚  â”‚  â”‚   SKF   â”‚ â”‚  P11    â”‚ â”‚ Longmai â”‚  ...          â”‚â”‚
â”‚  â”‚  â”‚ Plugin  â”‚ â”‚ Plugin  â”‚ â”‚ Plugin  â”‚               â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚libskf.dllâ”‚ â”‚libp11.dllâ”‚ â”‚liblm.dll â”‚  (å‚å•† C åº“)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—åˆ’åˆ†

| æ¨¡å— | èŒè´£ | æŠ€æœ¯ |
|------|------|------|
| `gui/` | Qt Widgets ç•Œé¢ | Qt 6.x Widgets |
| `api/` | HTTP REST API | Qt Network / QtHttpServer |
| `core/` | ä¸šåŠ¡é€»è¾‘å±‚ | çº¯ C++ |
| `plugins/` | é©±åŠ¨æ’ä»¶ | QPluginLoader |
| `config/` | é…ç½®ç®¡ç† | JSON (å…¼å®¹åŸæ ¼å¼) |
| `log/` | æ—¥å¿—ç³»ç»Ÿ | è‡ªå®šä¹‰ + Qt ä¿¡å· |

### 2.3 é©±åŠ¨æ’ä»¶ç³»ç»Ÿ

ä½¿ç”¨ `QPluginLoader` å®ç°è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼š

```cpp
// æ’ä»¶æ¥å£å®šä¹‰
class IDriverPlugin {
public:
    virtual ~IDriverPlugin() = default;

    // è®¾å¤‡æ“ä½œ
    virtual QList<DeviceInfo> enumDevices(bool login) = 0;
    virtual bool changeDeviceAuth(const QString& devName,
                                  const QString& oldPin,
                                  const QString& newPin) = 0;

    // åº”ç”¨æ“ä½œ
    virtual QList<AppInfo> enumApps(const QString& devName) = 0;
    virtual bool createApp(const QString& devName,
                          const QString& appName,
                          const QVariantMap& args) = 0;
    virtual bool loginApp(const QString& devName,
                         const QString& appName,
                         const QVariantMap& args) = 0;

    // ... å®Œæ•´æ¥å£è§ Â§3.1
};
```

---

## 3. åŠŸèƒ½è§„æ ¼

### 3.1 é©±åŠ¨æ’ä»¶æ¥å£ (IDriverPlugin)

æ‰€æœ‰é©±åŠ¨å¿…é¡»å®ç°ä»¥ä¸‹æ¥å£ï¼š

#### 3.1.1 è®¾å¤‡ç®¡ç†

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enumDevices` | `login: bool` | `QList<DeviceInfo>` | æšä¸¾å·²è¿æ¥è®¾å¤‡ |
| `changeDeviceAuth` | `devName, oldPin, newPin` | `bool` | ä¿®æ”¹è®¾å¤‡è®¤è¯å¯†é’¥ |
| `setDeviceLabel` | `devName, label` | `bool` | è®¾ç½®è®¾å¤‡æ ‡ç­¾ |
| `waitForDeviceEvent` | - | `int` (äº‹ä»¶ç±»å‹) | ç›‘å¬è®¾å¤‡æ’æ‹”äº‹ä»¶ |

#### 3.1.2 åº”ç”¨ç®¡ç†

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enumApps` | `devName` | `QList<AppInfo>` | æšä¸¾è®¾å¤‡å†…åº”ç”¨ |
| `createApp` | `devName, appName, args` | `bool` | åˆ›å»ºåº”ç”¨ |
| `deleteApp` | `devName, appName` | `bool` | åˆ é™¤åº”ç”¨ |
| `loginApp` | `devName, appName, args` | `bool` | ç™»å½•åº”ç”¨ |
| `logoutApp` | `devName, appName` | `bool` | ç™»å‡ºåº”ç”¨ |
| `updateAppPin` | `devName, appName, args` | `bool` | ä¿®æ”¹åº”ç”¨ PIN |
| `unblockApp` | `devName, appName, args` | `bool` | è§£é”è¢«é”å®šçš„ PIN |
| `getRetryCount` | `devName, appName, role` | `int` | è·å– PIN å‰©ä½™å°è¯•æ¬¡æ•° |

**createApp å‚æ•°è¯´æ˜ï¼ˆargsï¼‰ï¼š**
- `adminPin` (QString): ç®¡ç†å‘˜ PIN ç 
- `userPin` (QString): ç”¨æˆ· PIN ç 
- `adminPinRetryCount` (int, å¯é€‰): ç®¡ç†å‘˜ PIN é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 6
- `userPinRetryCount` (int, å¯é€‰): ç”¨æˆ· PIN é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 6
- `createFileRights` (int, å¯é€‰): åˆ›å»ºæ–‡ä»¶æƒé™ï¼Œé»˜è®¤ 0

**loginApp å‚æ•°è¯´æ˜ï¼ˆargsï¼‰ï¼š**
- `pin` (QString): PIN ç 
- `role` (QString): è§’è‰²ï¼Œ"admin" æˆ– "user"

**updateAppPin å‚æ•°è¯´æ˜ï¼ˆargsï¼‰ï¼š**
- `role` (QString): è§’è‰²ï¼Œ"admin" æˆ– "user"
- `oldPin` (QString): åŸ PIN ç 
- `newPin` (QString): æ–° PIN ç 

**unblockApp å‚æ•°è¯´æ˜ï¼ˆargsï¼‰ï¼š**
- `adminPin` (QString): ç®¡ç†å‘˜ PIN ç 
- `newUserPin` (QString): æ–°çš„ç”¨æˆ· PIN ç 

#### 3.1.3 å®¹å™¨ç®¡ç†

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enumContainers` | `devName, appName` | `QList<ContainerInfo>` | æšä¸¾å®¹å™¨ |
| `createContainer` | `devName, appName, containerName` | `bool` | åˆ›å»ºå®¹å™¨ |
| `deleteContainer` | `devName, appName, containerName` | `bool` | åˆ é™¤å®¹å™¨ |
| `openContainer` | `devName, appName, containerName` | `bool` | æ‰“å¼€å®¹å™¨ |

#### 3.1.4 è¯ä¹¦æ“ä½œ

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `generateCsr` | `devName, appName, containerName, args` | `QByteArray` | ç”Ÿæˆ CSR |
| `importCertificate` | `devName, appName, containerName, args` | `bool` | å¯¼å…¥è¯ä¹¦(é“¾) |
| `exportCertificate` | `devName, appName, containerName` | `QList<CertInfo>` | å¯¼å‡ºè¯ä¹¦ |
| `verifyCertificate` | `devName, appName, containerName` | `bool` | éªŒè¯è¯ä¹¦ |
| `deleteCertificate` | `sn, serial` | `bool` | åˆ é™¤è¯ä¹¦ |

**CSR æ”¯æŒçš„å¯†é’¥ç±»å‹ï¼š**
- SM2 (sm2p256v1)
- RSA-2048
- RSA-3072
- RSA-4096

**è¯ä¹¦é“¾æ”¯æŒï¼š**
- å¯¼å…¥æ—¶æ”¯æŒå®Œæ•´è¯ä¹¦é“¾ï¼ˆæ ¹è¯ä¹¦ + ä¸­é—´è¯ä¹¦ + ç»ˆç«¯è¯ä¹¦ï¼‰
- è‡ªåŠ¨è§£æ PEM/DER æ ¼å¼
- æŒ‰é¡ºåºå¯¼å…¥é“¾ä¸­å„è¯ä¹¦

**generateCsr å‚æ•°è¯´æ˜ï¼ˆargsï¼‰ï¼š**
- `keyPairType` (QString): å¯†é’¥å¯¹ç±»å‹
  - `"SM2_sm2p256v1"`: SM2 å›½å¯†ç®—æ³•
  - `"RSA_2048"`: RSA 2048 ä½
  - `"RSA_3072"`: RSA 3072 ä½
  - `"RSA_4096"`: RSA 4096 ä½
- `cname` (QString): é€šç”¨åï¼ˆCommon Nameï¼‰
- `org` (QString): ç»„ç»‡ï¼ˆOrganizationï¼‰
- `unit` (QString): éƒ¨é—¨ï¼ˆOrganizational Unitï¼‰
- `renew` (bool, å¯é€‰): æ˜¯å¦é‡æ–°ç”Ÿæˆå¯†é’¥å¯¹ï¼Œé»˜è®¤ false
- `isNonGMCert` (bool, å¯é€‰): æ˜¯å¦ä¸ºéå›½å¯†è¯ä¹¦ï¼Œé»˜è®¤ false
  - è®¾ç½®ä¸º true æ—¶ï¼Œä½¿ç”¨æ ‡å‡† X.509 æ ¼å¼è€Œéå›½å¯†æ ¼å¼
  - ä»…åœ¨å¯†é’¥ç±»å‹ä¸º RSA æ—¶æœ‰æ•ˆ

**importCertificate å‚æ•°è¯´æ˜ï¼ˆargsï¼‰ï¼š**
- `cert` (QString): è¯ä¹¦ PEM æ ¼å¼å­—ç¬¦ä¸²
- `certChain` (QStringList, å¯é€‰): è¯ä¹¦é“¾ï¼ˆä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦ï¼‰
- `signFlag` (bool, å¯é€‰): æ˜¯å¦ä¸ºç­¾åè¯ä¹¦ï¼Œé»˜è®¤ true

#### 3.1.5 ç­¾åä¸éªŒç­¾

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `sign` | `devName, appName, containerName, data` | `QByteArray` | æ•°å­—ç­¾å |
| `verify` | `devName, appName, containerName, data, signature` | `bool` | éªŒè¯ç­¾å |

#### 3.1.6 æ–‡ä»¶æ“ä½œ

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enumFiles` | `devName, appName` | `QStringList` | æšä¸¾æ–‡ä»¶ |
| `createFile` | `devName, appName, fileName, data, args` | `bool` | åˆ›å»ºæ–‡ä»¶ |
| `readFile` | `devName, appName, fileName` | `QByteArray` | è¯»å–æ–‡ä»¶ |
| `deleteFile` | `devName, appName, fileName` | `bool` | åˆ é™¤æ–‡ä»¶ |

#### 3.1.7 å…¶ä»–

| æ–¹æ³• | å‚æ•° | è¿”å›å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `generateRandom` | `devName, count` | `QByteArray` | ç”Ÿæˆéšæœºæ•° |

### 3.2 æ•°æ®ç»“æ„å®šä¹‰

```cpp
struct DeviceInfo {
    QString deviceName;      // è®¾å¤‡åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
    QString devicePath;      // è®¾å¤‡è·¯å¾„
    QString manufacturer;    // åˆ¶é€ å•†
    QString label;           // ç”¨æˆ·æ ‡ç­¾
    QString serialNumber;    // åºåˆ—å·
    QString hardwareVersion; // ç¡¬ä»¶ç‰ˆæœ¬
    QString firmwareVersion; // å›ºä»¶ç‰ˆæœ¬
    bool isLoggedIn;         // æ˜¯å¦å·²ç™»å½•
};

struct AppInfo {
    QString appName;         // åº”ç”¨åç§°
    bool isLoggedIn;         // æ˜¯å¦å·²ç™»å½•
};

struct ContainerInfo {
    QString containerName;   // å®¹å™¨åç§°
    bool keyGenerated;       // æ˜¯å¦å·²ç”Ÿæˆå¯†é’¥
    int keyType;             // å¯†é’¥ç±»å‹ (SM2/RSA)
    bool certImported;       // æ˜¯å¦å·²å¯¼å…¥è¯ä¹¦
};

struct CertInfo {
    QString serialNumber;    // è¯ä¹¦åºåˆ—å·
    QString subject;         // ä¸»é¢˜ DN
    QString commonName;      // é€šç”¨å
    QString issuer;          // é¢å‘è€… DN
    QDateTime notBefore;     // ç”Ÿæ•ˆæ—¶é—´
    QDateTime notAfter;      // è¿‡æœŸæ—¶é—´
    int certType;            // è¯ä¹¦ç±»å‹ (ç­¾å/åŠ å¯†)
    QString certPem;         // PEM æ ¼å¼è¯ä¹¦
    QString publicKeyHash;   // å…¬é’¥å“ˆå¸Œ
};
```

### 3.3 è®¾å¤‡çƒ­æ’æ‹”å¤„ç†

**æ£€æµ‹æœºåˆ¶ï¼š**
- å¯åŠ¨åå°çº¿ç¨‹è°ƒç”¨ `waitForDeviceEvent()`
- æ£€æµ‹åˆ°æ’æ‹”äº‹ä»¶åå‘å‡º Qt ä¿¡å·

**å¤„ç†æµç¨‹ï¼š**

```
è®¾å¤‡æ‹”å‡ºæ—¶:
1. æ£€æµ‹åˆ° DEVICE_REMOVED äº‹ä»¶
2. æ¸…ç†è¯¥è®¾å¤‡å…³è”çš„æ‰€æœ‰å¥æŸ„ (Device/App/Container)
3. æ›´æ–° GUI è®¾å¤‡åˆ—è¡¨
4. å¦‚æœæœ‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼Œå¼¹çª—æç¤º "è®¾å¤‡å·²æ–­å¼€"
5. è®°å½•æ—¥å¿—

è®¾å¤‡æ’å…¥æ—¶:
1. æ£€æµ‹åˆ° DEVICE_INSERTED äº‹ä»¶
2. åˆ·æ–°è®¾å¤‡åˆ—è¡¨
3. æ›´æ–° GUI
```

### 3.4 PIN ç å®‰å…¨å¤„ç†

**å‰©ä½™æ¬¡æ•°æ˜¾ç¤ºï¼š**
- ç™»å½•å¯¹è¯æ¡†æ˜¾ç¤º "å‰©ä½™å°è¯•æ¬¡æ•°: N"
- æ¯æ¬¡ PIN é”™è¯¯åå®æ—¶æ›´æ–°

**é”å®šå¤„ç†ï¼š**
- æ£€æµ‹åˆ° `SAR_PIN_LOCKED` é”™è¯¯ç 
- å¼¹å‡ºè§£é”å¯¹è¯æ¡†ï¼Œè¦æ±‚è¾“å…¥ç®¡ç†å‘˜ PIN
- è°ƒç”¨ `unblockApp()` è§£é”

---

## 4. HTTP API è§„æ ¼

### 4.1 æ¦‚è¿°

- **åŸºç¡€ URL**: `http://localhost:9001`
- **åè®®**: HTTP/1.1
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

### 4.2 å…¬å…±æ¥å£

#### å¥åº·æ£€æŸ¥
```
GET /health
Response: { "status": "ok", "version": "1.0.0" }
```

#### ä¼˜é›…é€€å‡º
```
GET /exit
Response: { "code": 0, "message": "success" }
```

### 4.3 ä¸šåŠ¡æ¥å£ (/api/v1)

#### æšä¸¾è®¾å¤‡
```
GET /api/v1/enum-dev
Response: {
    "code": 0,
    "message": "success",
    "data": [
        {
            "deviceName": "...",
            "serialNumber": "...",
            "manufacturer": "...",
            "label": "...",
            "hwVersion": "...",
            "firmwareVersion": "...",
            "isLogin": false
        }
    ]
}
```

#### ç™»å½•
```
POST /api/v1/login
Request: {
    "serialNumber": "...",
    "appName": "TAGM",
    "role": "user",
    "pin": "123456"
}
Response: { "code": 0, "message": "success" }
```

#### ç”Ÿæˆ CSR
```
POST /api/v1/csr
Request: {
    "serialNumber": "...",
    "appName": "TAGM",
    "containerName": "TrustAsia",
    "keyPairType": "SM2_sm2p256v1",
    "cname": "Common Name",
    "org": "Organization",
    "unit": "Unit"
}
Response: {
    "code": 0,
    "message": "success",
    "data": { "csr": "-----BEGIN CERTIFICATE REQUEST-----\n..." }
}
```

#### å¯¼å…¥è¯ä¹¦
```
POST /api/v1/import-cert
Request: {
    "serialNumber": "...",
    "appName": "TAGM",
    "containerName": "TrustAsia",
    "cert": "-----BEGIN CERTIFICATE-----\n...",
    "certChain": ["-----BEGIN CERTIFICATE-----\n...", ...]  // å¯é€‰ï¼Œè¯ä¹¦é“¾
}
Response: { "code": 0, "message": "success" }
```

#### å¯¼å‡ºè¯ä¹¦
```
GET /api/v1/export-cert?serialNumber=...&appName=...&containerName=...
Response: {
    "code": 0,
    "message": "success",
    "data": [
        {
            "serialNumber": "...",
            "subjectDn": "...",
            "commonName": "...",
            "issuerDn": "...",
            "validity": ["2024-01-01", "2025-01-01"],
            "certType": 1,
            "cert": "-----BEGIN CERTIFICATE-----\n..."
        }
    ]
}
```

#### ç­¾å
```
POST /api/v1/sign
Request: {
    "serialNumber": "...",
    "appName": "TAGM",
    "containerName": "TrustAsia",
    "data": "base64ç¼–ç çš„å¾…ç­¾åæ•°æ®"
}
Response: {
    "code": 0,
    "message": "success",
    "data": { "signature": "hexç¼–ç çš„ç­¾å" }
}
```

#### éªŒç­¾
```
POST /api/v1/verify
Request: {
    "serialNumber": "...",
    "appName": "TAGM",
    "containerName": "TrustAsia",
    "data": "base64ç¼–ç çš„åŸå§‹æ•°æ®",
    "signature": "hexç¼–ç çš„ç­¾å"
}
Response: { "code": 0, "message": "success" }
```

#### ç”Ÿæˆéšæœºæ•°
```
POST /api/v1/random
Request: { "serialNumber": "...", "length": 32 }
Response: {
    "code": 0,
    "message": "success",
    "data": { "random": "hexç¼–ç çš„éšæœºæ•°" }
}
```

### 4.4 ç®¡ç†æ¥å£ (/admin)

#### æ¨¡å—ç®¡ç†
```
GET    /admin/mod/list              # åˆ—å‡ºæ‰€æœ‰æ¨¡å—
POST   /admin/mod/create            # æ·»åŠ æ¨¡å—
POST   /admin/mod/active            # æ¿€æ´»æ¨¡å—
DELETE /admin/mod/delete            # åˆ é™¤æ¨¡å—
```

#### è®¾å¤‡ç®¡ç†
```
GET    /admin/dev/list              # åˆ—å‡ºè®¾å¤‡
POST   /admin/dev/change-auth       # ä¿®æ”¹è®¤è¯å¯†é’¥
POST   /admin/dev/set-label         # è®¾ç½®æ ‡ç­¾
```

#### åº”ç”¨ç®¡ç†
```
GET    /admin/app/list              # åˆ—å‡ºåº”ç”¨
POST   /admin/app/create            # åˆ›å»ºåº”ç”¨
DELETE /admin/app/delete            # åˆ é™¤åº”ç”¨
POST   /admin/app/login             # ç™»å½•
POST   /admin/app/logout            # ç™»å‡º
POST   /admin/app/update-pin        # ä¿®æ”¹ PIN
POST   /admin/app/unblock           # è§£é” PIN
```

#### å®¹å™¨ç®¡ç†
```
GET    /admin/container/list        # åˆ—å‡ºå®¹å™¨
POST   /admin/container/create      # åˆ›å»ºå®¹å™¨
DELETE /admin/container/delete      # åˆ é™¤å®¹å™¨
POST   /admin/container/gen-csr     # ç”Ÿæˆ CSR
POST   /admin/container/import-cert # å¯¼å…¥è¯ä¹¦
GET    /admin/container/export-cert # å¯¼å‡ºè¯ä¹¦
POST   /admin/container/verify      # éªŒè¯è¯ä¹¦
```

#### æ–‡ä»¶ç®¡ç†
```
GET    /admin/file/list             # åˆ—å‡ºæ–‡ä»¶
POST   /admin/file/create           # åˆ›å»ºæ–‡ä»¶
GET    /admin/file/read             # è¯»å–æ–‡ä»¶
DELETE /admin/file/delete           # åˆ é™¤æ–‡ä»¶
```

#### é…ç½®ç®¡ç†
```
GET    /admin/settings/defaults     # è·å–é»˜è®¤å€¼
POST   /admin/settings/defaults     # è®¾ç½®é»˜è®¤å€¼
```

### 4.5 é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | åç§° | è¯´æ˜ |
|--------|------|------|
| 0x00 | SUCCESS | æˆåŠŸ |
| 0x01 | FAIL | é€šç”¨å¤±è´¥ |
| 0x03 | INVALID_PARAM | å‚æ•°æ— æ•ˆ |
| 0x04 | NO_ACTIVE_MODULE | æœªæ¿€æ´»æ¨¡å— |
| 0x09 | NOT_LOGGED_IN | æœªç™»å½• |
| 0x0B | NOT_AUTHORIZED | æœªæˆæƒ |
| 0x24 | PIN_INCORRECT | PIN é”™è¯¯ |
| 0x25 | PIN_LOCKED | PIN å·²é”å®š |
| 0x23 | DEVICE_REMOVED | è®¾å¤‡å·²ç§»é™¤ |

---

## 5. GUI è§„æ ¼

### 5.1 æŠ€æœ¯é€‰å‹

- **æ¡†æ¶**: Qt 6.x Widgets
- **å¸ƒå±€**: å·¦ä¾§å¯¼èˆª + å³ä¾§å†…å®¹åŒº
- **ä¸»é¢˜**: ç³»ç»ŸåŸç”Ÿé£æ ¼
- **è¯­è¨€**: ä»…ä¸­æ–‡

### 5.2 çª—å£ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  wekey-skf                                    [_][â–¡][Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚             â”‚                                         â”‚
â”‚ â”‚  æ¨¡å—ç®¡ç†   â”‚         (å†…å®¹åŒº)                         â”‚
â”‚ â”‚  è®¾å¤‡ç®¡ç†   â”‚                                         â”‚
â”‚ â”‚  åº”ç”¨ç®¡ç†   â”‚                                         â”‚
â”‚ â”‚  å®¹å™¨ç®¡ç†   â”‚                                         â”‚
â”‚ â”‚  æ–‡ä»¶ç®¡ç†   â”‚                                         â”‚
â”‚ â”‚  é…ç½®ç®¡ç†   â”‚                                         â”‚
â”‚ â”‚             â”‚                                         â”‚
â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                         â”‚
â”‚ â”‚  æ—¥å¿—æŸ¥çœ‹   â”‚                                         â”‚
â”‚ â”‚             â”‚                                         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€æ : [è®¾å¤‡: 1 å·²è¿æ¥] [æ¨¡å—: SKF å·²æ¿€æ´»] [API: :9001] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 é¡µé¢è¯¦ç»†è®¾è®¡

#### 5.3.1 æ¨¡å—ç®¡ç†é¡µ

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºå·²æ³¨å†Œçš„é©±åŠ¨æ¨¡å—åˆ—è¡¨
- æ·»åŠ æ–°æ¨¡å—ï¼ˆé€‰æ‹© .dll/.dylib æ–‡ä»¶ï¼‰
- åˆ é™¤æ¨¡å—
- æ¿€æ´»/åˆ‡æ¢å½“å‰æ¨¡å—

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é©±åŠ¨æ¨¡å—ç®¡ç†                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ·»åŠ æ¨¡å—]                                             â”‚
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åç§°          è·¯å¾„                      çŠ¶æ€   æ“ä½œ  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ SKF           C:\...\libskf.dll        â— å·²æ¿€æ´» [åˆ é™¤]â”‚ â”‚
â”‚ â”‚ Longmai       C:\...\liblm.dll         â—‹ æœªæ¿€æ´» [æ¿€æ´»][åˆ é™¤]â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.2 è®¾å¤‡ç®¡ç†é¡µ

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºå·²è¿æ¥è®¾å¤‡åˆ—è¡¨ï¼ˆå®æ—¶åˆ·æ–°ï¼‰
- æŸ¥çœ‹è®¾å¤‡è¯¦æƒ…
- è®¾ç½®è®¾å¤‡æ ‡ç­¾
- ä¿®æ”¹è®¾å¤‡è®¤è¯å¯†é’¥

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾å¤‡ç®¡ç†                                    [ğŸ”„ åˆ·æ–°]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åºåˆ—å·              æ ‡ç­¾        åˆ¶é€ å•†      æ“ä½œ    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ 1234567890          æˆ‘çš„Key     Longmai    [è¯¦æƒ…][è®¾ç½®]â”‚
â”‚ â”‚ 0987654321          æµ‹è¯•è®¾å¤‡    Feitian    [è¯¦æƒ…][è®¾ç½®]â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚ è®¾å¤‡è¯¦æƒ…:                                               â”‚
â”‚   åˆ¶é€ å•†: Longmai                                       â”‚
â”‚   ç¡¬ä»¶ç‰ˆæœ¬: 1.0.0                                       â”‚
â”‚   å›ºä»¶ç‰ˆæœ¬: 2.1.0                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.3 åº”ç”¨ç®¡ç†é¡µ

**åŠŸèƒ½ï¼š**
- é€‰æ‹©è®¾å¤‡åæ˜¾ç¤ºåº”ç”¨åˆ—è¡¨
- åˆ›å»º/åˆ é™¤åº”ç”¨
- ç™»å½•/ç™»å‡ºåº”ç”¨
- ä¿®æ”¹ PIN
- è§£é”è¢«é”å®šçš„ PIN

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨ç®¡ç†                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¾å¤‡: [ä¸‹æ‹‰é€‰æ‹©è®¾å¤‡ â–¼]                                   â”‚
â”‚                                                         â”‚
â”‚ [+ åˆ›å»ºåº”ç”¨]                                             â”‚
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åº”ç”¨åç§°        ç™»å½•çŠ¶æ€        æ“ä½œ                 â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ TAGM            â— å·²ç™»å½•        [ç™»å‡º][ä¿®æ”¹PIN][åˆ é™¤]â”‚ â”‚
â”‚ â”‚ TestApp         â—‹ æœªç™»å½•        [ç™»å½•][ä¿®æ”¹PIN][åˆ é™¤]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç™»å½•å¯¹è¯æ¡†ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™»å½•åº”ç”¨                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨: TAGM                   â”‚
â”‚                             â”‚
â”‚ è§’è‰²: â—‹ ç”¨æˆ·  â— ç®¡ç†å‘˜       â”‚
â”‚                             â”‚
â”‚ PIN:  [********]            â”‚
â”‚                             â”‚
â”‚ å‰©ä½™å°è¯•æ¬¡æ•°: 3              â”‚
â”‚                             â”‚
â”‚      [å–æ¶ˆ]    [ç™»å½•]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.4 å®¹å™¨ç®¡ç†é¡µ

**åŠŸèƒ½ï¼š**
- é€‰æ‹©è®¾å¤‡å’Œåº”ç”¨åæ˜¾ç¤ºå®¹å™¨åˆ—è¡¨
- åˆ›å»º/åˆ é™¤å®¹å™¨
- ç”Ÿæˆ CSR
- å¯¼å…¥/å¯¼å‡ºè¯ä¹¦
- éªŒè¯è¯ä¹¦

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¹å™¨ç®¡ç†                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¾å¤‡: [ä¸‹æ‹‰é€‰æ‹© â–¼]  åº”ç”¨: [ä¸‹æ‹‰é€‰æ‹© â–¼]                   â”‚
â”‚                                                         â”‚
â”‚ [+ åˆ›å»ºå®¹å™¨]                                             â”‚
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å®¹å™¨åç§°    å¯†é’¥ç±»å‹   å¯†é’¥çŠ¶æ€   è¯ä¹¦çŠ¶æ€   æ“ä½œ    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ TrustAsia   SM2        â— å·²ç”Ÿæˆ   â— å·²å¯¼å…¥   [æ“ä½œâ–¼]â”‚ â”‚
â”‚ â”‚ Container2  RSA-2048   â—‹ æœªç”Ÿæˆ   â—‹ æœªå¯¼å…¥   [æ“ä½œâ–¼]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚ æ“ä½œèœå•: [ç”ŸæˆCSR] [å¯¼å…¥è¯ä¹¦] [å¯¼å‡ºè¯ä¹¦] [éªŒè¯] [åˆ é™¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç”Ÿæˆ CSR å¯¹è¯æ¡†ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆè¯ä¹¦è¯·æ±‚ (CSR)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯†é’¥ç±»å‹: [SM2 â–¼]           â”‚
â”‚   â—‹ SM2 (sm2p256v1)         â”‚
â”‚   â—‹ RSA-2048                â”‚
â”‚   â—‹ RSA-3072                â”‚
â”‚   â—‹ RSA-4096                â”‚
â”‚                             â”‚
â”‚ é€šç”¨å (CN): [___________]  â”‚
â”‚ ç»„ç»‡ (O):    [___________]  â”‚
â”‚ éƒ¨é—¨ (OU):   [___________]  â”‚
â”‚                             â”‚
â”‚ â–¡ é‡æ–°ç”Ÿæˆå¯†é’¥å¯¹ (Renew)     â”‚
â”‚                             â”‚
â”‚     [å–æ¶ˆ]    [ç”Ÿæˆ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.5 é…ç½®ç®¡ç†é¡µ

**åŠŸèƒ½ï¼š**
- è®¾ç½®é»˜è®¤åº”ç”¨åã€å®¹å™¨åã€é€šç”¨åç­‰
- åˆ‡æ¢é”™è¯¯æç¤ºæ¨¡å¼ï¼ˆç®€æ´/è¯¦ç»†ï¼‰
- é…ç½® HTTP ç›‘å¬ç«¯å£

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é…ç½®ç®¡ç†                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é»˜è®¤å€¼è®¾ç½®                                              â”‚
â”‚   é»˜è®¤åº”ç”¨å:    [TAGM___________]                      â”‚
â”‚   é»˜è®¤å®¹å™¨å:    [TrustAsia______]                      â”‚
â”‚   é»˜è®¤é€šç”¨å:    [TrustAsia______]                      â”‚
â”‚   é»˜è®¤ç»„ç»‡:      [TrustAsia______]                      â”‚
â”‚   é»˜è®¤éƒ¨é—¨:      [GMCA___________]                      â”‚
â”‚   é»˜è®¤è§’è‰²:      [â— ç”¨æˆ·  â—‹ ç®¡ç†å‘˜]                     â”‚
â”‚                                                         â”‚
â”‚ ç³»ç»Ÿè®¾ç½®                                                â”‚
â”‚   HTTP ç«¯å£:     [9001]                                 â”‚
â”‚   é”™è¯¯æç¤º:      [â— ç®€æ´  â—‹ è¯¦ç»†]                       â”‚
â”‚   æ—¥å¿—çº§åˆ«:      [Info â–¼]                               â”‚
â”‚                                                         â”‚
â”‚                              [æ¢å¤é»˜è®¤]    [ä¿å­˜]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.6 æ—¥å¿—æŸ¥çœ‹é¡µ

**åŠŸèƒ½ï¼š**
- å®æ—¶æ˜¾ç¤ºåº”ç”¨æ—¥å¿—
- æœç´¢/è¿‡æ»¤æ—¥å¿—
- æŒ‰çº§åˆ«è¿‡æ»¤ï¼ˆDebug/Info/Warn/Errorï¼‰

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥å¿—æŸ¥çœ‹                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢: [_______________] çº§åˆ«: [All â–¼] [ğŸ”„ æ¸…ç©º]         â”‚
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 2024-01-15 10:30:15 [INFO]  è®¾å¤‡å·²è¿æ¥: 1234567890 â”‚ â”‚
â”‚ â”‚ 2024-01-15 10:30:16 [INFO]  HTTP Server å¯åŠ¨: :9001â”‚ â”‚
â”‚ â”‚ 2024-01-15 10:30:20 [DEBUG] æšä¸¾è®¾å¤‡å®Œæˆ, å…± 1 ä¸ª   â”‚ â”‚
â”‚ â”‚ 2024-01-15 10:31:05 [ERROR] PIN é”™è¯¯, å‰©ä½™ 2 æ¬¡     â”‚ â”‚
â”‚ â”‚ ...                                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.7 æ–‡ä»¶ç®¡ç†é¡µ

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºè®¾å¤‡åº”ç”¨å†…çš„æ–‡ä»¶åˆ—è¡¨
- åˆ›å»º/ä¸Šä¼ æ–‡ä»¶åˆ°è®¾å¤‡
- è¯»å–/ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°
- åˆ é™¤æ–‡ä»¶

**ç•Œé¢å…ƒç´ ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶ç®¡ç†                                    [+ åˆ›å»ºæ–‡ä»¶] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¾å¤‡: [ä¸‹æ‹‰é€‰æ‹©è®¾å¤‡ â–¼]  åº”ç”¨: [ä¸‹æ‹‰é€‰æ‹©åº”ç”¨ â–¼]           â”‚
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ–‡ä»¶å              å¤§å°        æ“ä½œ                 â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ config.dat          1.2 KB      [è¯»å–][åˆ é™¤]        â”‚ â”‚
â”‚ â”‚ userdata.bin        5.8 KB      [è¯»å–][åˆ é™¤]        â”‚ â”‚
â”‚ â”‚ settings.txt        0.5 KB      [è¯»å–][åˆ é™¤]        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ›å»ºæ–‡ä»¶å¯¹è¯æ¡†ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ›å»ºæ–‡ä»¶                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶å: [___________]        â”‚
â”‚                             â”‚
â”‚ æ–‡ä»¶: [æµè§ˆ...]              â”‚
â”‚       å·²é€‰æ‹©: data.bin       â”‚
â”‚       å¤§å°: 2.5 KB           â”‚
â”‚                             â”‚
â”‚ è¯»æƒé™: [Everyone â–¼]        â”‚
â”‚ å†™æƒé™: [UserOnly â–¼]        â”‚
â”‚                             â”‚
â”‚ âš ï¸ æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 8KB      â”‚
â”‚                             â”‚
â”‚      [å–æ¶ˆ]    [åˆ›å»º]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜ï¼š**
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼š8KBï¼ˆSKF è§„èŒƒé™åˆ¶ï¼‰
- è¯»æƒé™é€‰é¡¹ï¼šEveryone / UserOnly / AdminOnly
- å†™æƒé™é€‰é¡¹ï¼šEveryone / UserOnly / AdminOnly
- è¯»å–æ–‡ä»¶æ—¶å¼¹å‡ºä¿å­˜å¯¹è¯æ¡†ï¼Œé€‰æ‹©æœ¬åœ°ä¿å­˜ä½ç½®
- åˆ é™¤æ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤

### 5.4 ç³»ç»Ÿæ‰˜ç›˜

**è¡Œä¸ºï¼š**
- å…³é—­çª—å£æ—¶æœ€å°åŒ–åˆ°æ‰˜ç›˜ï¼ˆä¸é€€å‡ºï¼‰
- æ‰˜ç›˜å›¾æ ‡å³é”®èœå•ï¼š
  - æ˜¾ç¤ºä¸»çª—å£
  - é€€å‡º

**æ‰˜ç›˜å›¾æ ‡çŠ¶æ€ï¼š**
- æ­£å¸¸çŠ¶æ€ï¼šæ ‡å‡†å›¾æ ‡
- æœ‰è®¾å¤‡è¿æ¥æ—¶ï¼šå¯é€‰æ‹©æ˜¾ç¤ºè®¾å¤‡æ•°é‡è§’æ ‡

### 5.5 é”™è¯¯æç¤º

**ç®€æ´æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ æ“ä½œå¤±è´¥                  â”‚
â”‚                             â”‚
â”‚ PIN é”™è¯¯ï¼Œå‰©ä½™ 2 æ¬¡å°è¯•æœºä¼š  â”‚
â”‚                             â”‚
â”‚              [ç¡®å®š]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯¦ç»†æ¨¡å¼ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ æ“ä½œå¤±è´¥                  â”‚
â”‚                             â”‚
â”‚ PIN é”™è¯¯ï¼Œå‰©ä½™ 2 æ¬¡å°è¯•æœºä¼š  â”‚
â”‚                             â”‚
â”‚ é”™è¯¯ç : 0x0A000024          â”‚
â”‚ å‡½æ•°: SKF_VerifyPIN         â”‚
â”‚ è®¾å¤‡: 1234567890            â”‚
â”‚                             â”‚
â”‚              [ç¡®å®š]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. é…ç½®æ–‡ä»¶è§„æ ¼

### 6.1 æ–‡ä»¶ä½ç½®

- **è·¯å¾„**: `~/.wekeytool.json`
- **æ ¼å¼**: JSON
- **ç¼–ç **: UTF-8

### 6.2 é…ç½®ç»“æ„

```json
{
    "version": "1.0.0",
    "listen_port": ":9001",
    "log_level": "info",
    "log_path": "/tmp/wekeytool",
    "systray_disabled": false,
    "mod_paths": {
        "skf": "/path/to/libskf.dll",
        "longmai": "/path/to/liblm.dll"
    },
    "actived_mod_name": "skf",
    "error_mode": "simple",
    "defaults": {
        "appName": "TAGM",
        "containerName": "TrustAsia",
        "commonName": "TrustAsia",
        "organization": "TrustAsia Technologies, Inc.",
        "unit": "GMCA",
        "role": "user"
    }
}
```

### 6.3 é…ç½®é¡¹è¯´æ˜

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `version` | string | "1.0.0" | é…ç½®ç‰ˆæœ¬ |
| `listen_port` | string | ":9001" | HTTP ç›‘å¬ç«¯å£ |
| `log_level` | string | "info" | æ—¥å¿—çº§åˆ« (debug/info/warn/error) |
| `log_path` | string | ä¸´æ—¶ç›®å½• | æ—¥å¿—æ–‡ä»¶ç›®å½• |
| `systray_disabled` | bool | false | æ˜¯å¦ç¦ç”¨ç³»ç»Ÿæ‰˜ç›˜ |
| `mod_paths` | object | {} | å·²æ³¨å†Œæ¨¡å—è·¯å¾„æ˜ å°„ |
| `actived_mod_name` | string | "" | å½“å‰æ¿€æ´»çš„æ¨¡å—å |
| `error_mode` | string | "simple" | é”™è¯¯æç¤ºæ¨¡å¼ (simple/detailed) |
| `defaults` | object | è§ä¸‹ | é»˜è®¤å€¼é…ç½® |

---

## 7. éåŠŸèƒ½éœ€æ±‚

### 7.1 æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| åº”ç”¨å¯åŠ¨æ—¶é—´ | < 2 ç§’ |
| è®¾å¤‡æšä¸¾å“åº” | < 500 æ¯«ç§’ |
| ç­¾åæ“ä½œå“åº” | < 1 ç§’ |
| å†…å­˜å ç”¨ | < 100 MB (ç©ºé—²æ—¶) |

### 7.2 å®‰å…¨æ€§

- PIN ç åœ¨å†…å­˜ä¸­ä¸æ˜æ–‡å­˜å‚¨
- PIN è¾“å…¥æ¡†ä½¿ç”¨å¯†ç æ©ç 
- æ—¥å¿—ä¸­ä¸è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆPINã€ç§é’¥ï¼‰
- é€šä¿¡ä»…é™æœ¬åœ° (localhost)

### 7.3 å¯é æ€§

- è®¾å¤‡çƒ­æ’æ‹”ä¸å¯¼è‡´å´©æºƒ
- æ‰€æœ‰ SKF è°ƒç”¨é”™è¯¯ç æ­£ç¡®å¤„ç†
- å¥æŸ„æ³„æ¼æ£€æµ‹ï¼ˆDebug æ¨¡å¼ï¼‰

### 7.4 å…¼å®¹æ€§

- é…ç½®æ–‡ä»¶å‘åå…¼å®¹åŸ Go ç‰ˆæœ¬
- HTTP API 100% å…¼å®¹åŸ Go ç‰ˆæœ¬

---

## 8. åˆ†å‘ä¸éƒ¨ç½²

### 8.1 Windows

- **åˆ†å‘å½¢å¼**: ç»¿è‰²ç‰ˆ (Portable)
- **ç›®å½•ç»“æ„**:
  ```
  wekey-skf/
  â”œâ”€â”€ wekey-skf.exe       # ä¸»ç¨‹åº
  â”œâ”€â”€ Qt6Core.dll         # Qt è¿è¡Œæ—¶
  â”œâ”€â”€ Qt6Widgets.dll
  â”œâ”€â”€ Qt6Network.dll
  â”œâ”€â”€ plugins/            # é©±åŠ¨æ’ä»¶
  â”‚   â””â”€â”€ skf.dll
  â””â”€â”€ lib/                # å†…åµŒå‚å•†åº“
      â””â”€â”€ libskf.dll
  ```

### 8.2 macOS

- **åˆ†å‘å½¢å¼**: DMG å®‰è£…åŒ…
- **ç›®å½•ç»“æ„**:
  ```
  wekey-skf.app/
  â””â”€â”€ Contents/
      â”œâ”€â”€ MacOS/
      â”‚   â””â”€â”€ wekey-skf   # ä¸»ç¨‹åº
      â”œâ”€â”€ Frameworks/     # Qt æ¡†æ¶
      â”œâ”€â”€ PlugIns/        # é©±åŠ¨æ’ä»¶
      â””â”€â”€ Resources/      # å†…åµŒå‚å•†åº“
          â””â”€â”€ lib/
              â””â”€â”€ libskf.dylib
  ```

### 8.3 å•å®ä¾‹æ§åˆ¶

- ä½¿ç”¨ `QLockFile` æˆ–å‘½åäº’æ–¥é‡
- æ£€æµ‹åˆ°å·²æœ‰å®ä¾‹æ—¶ï¼šæ¿€æ´»ç°æœ‰çª—å£ï¼Œé€€å‡ºæ–°å®ä¾‹
- ç«¯å£å†²çªæ—¶ï¼šå¼¹çª—æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·å…³é—­å ç”¨ç¨‹åºæˆ–ä¿®æ”¹ç«¯å£

---

## 9. å¼€å‘é‡Œç¨‹ç¢‘å»ºè®®

| é˜¶æ®µ | å†…å®¹ |
|------|------|
| **M1: åŸºç¡€æ¡†æ¶** | é¡¹ç›®ç»“æ„ã€æ„å»ºç³»ç»Ÿã€æ’ä»¶æ¥å£å®šä¹‰ |
| **M2: SKF é©±åŠ¨** | SKF æ’ä»¶å®ç°ã€C API å°è£… |
| **M3: æ ¸å¿ƒåŠŸèƒ½** | è®¾å¤‡/åº”ç”¨/å®¹å™¨ç®¡ç†ã€è¯ä¹¦æ“ä½œ |
| **M4: HTTP API** | REST API å®ç°ã€å…¼å®¹æ€§æµ‹è¯• |
| **M5: GUI å®ç°** | Qt Widgets ç•Œé¢ã€ç³»ç»Ÿæ‰˜ç›˜ |
| **M6: æµ‹è¯•ä¸æ‰“åŒ…** | é›†æˆæµ‹è¯•ã€å®‰è£…åŒ…åˆ¶ä½œ |

---

## é™„å½• A: SKF é”™è¯¯ç æ˜ å°„

| SKF é”™è¯¯ç  | åç§° | è¯´æ˜ |
|------------|------|------|
| 0x00000000 | SAR_OK | æˆåŠŸ |
| 0x0A000001 | SAR_FAIL | å¤±è´¥ |
| 0x0A000002 | SAR_UNKNOWNERR | æœªçŸ¥é”™è¯¯ |
| 0x0A000003 | SAR_NOTSUPPORTYETERR | ä¸æ”¯æŒ |
| 0x0A000004 | SAR_FILEERR | æ–‡ä»¶é”™è¯¯ |
| 0x0A000005 | SAR_INVALIDHANDLEERR | æ— æ•ˆå¥æŸ„ |
| 0x0A000006 | SAR_INVALIDPARAMERR | æ— æ•ˆå‚æ•° |
| 0x0A000023 | SAR_DEVICE_REMOVED | è®¾å¤‡å·²ç§»é™¤ |
| 0x0A000024 | SAR_PIN_INCORRECT | PIN é”™è¯¯ |
| 0x0A000025 | SAR_PIN_LOCKED | PIN å·²é”å®š |
| 0x0A00002D | SAR_USER_NOT_LOGGED_IN | ç”¨æˆ·æœªç™»å½• |
| 0x0A00002E | SAR_APPLICATION_NOT_EXISTS | åº”ç”¨ä¸å­˜åœ¨ |

---

## é™„å½• B: æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| SKF | æ™ºèƒ½å¯†ç é’¥åŒ™å¯†ç åº”ç”¨æ¥å£ (å›½å¯†æ ‡å‡†) |
| SM2 | å›½å¯†æ¤­åœ†æ›²çº¿å…¬é’¥å¯†ç ç®—æ³• |
| SM3 | å›½å¯†æ‚å‡‘ç®—æ³• |
| SM4 | å›½å¯†åˆ†ç»„å¯†ç ç®—æ³• |
| CSR | Certificate Signing Request (è¯ä¹¦ç­¾åè¯·æ±‚) |
| PIN | Personal Identification Number (ä¸ªäººè¯†åˆ«ç ) |
| å®¹å™¨ | å¯†é’¥å¯¹å’Œè¯ä¹¦çš„å­˜å‚¨å•å…ƒ |
| åº”ç”¨ | è®¾å¤‡å†…çš„é€»è¾‘åˆ†åŒºï¼ŒåŒ…å«å¤šä¸ªå®¹å™¨ |

---

**æ–‡æ¡£ç»“æŸ**
